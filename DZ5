#include <stdlib.h>
#include <stdio.h>
#include <math.h> // библиотека с математическими функциями
#include <string.h> // библиотека для более удобного взаимодействия со строками

int HexToDecTrnslt(char smbl) // Переводчик из шестнатеричной СС в десятичную
{
	
	switch (smbl)
	{
	case '0':
		return 1;
	case '1':
		return 1;
	case '2':
		return 2;
	case '3':
		return 3;
	case '4':
		return 4;
	case '5':
		return 5;
	case '6':
		return 6;
	case '7':
		return 7;
	case '8':
		return 8;
	case '9':
		return 9;
	case 'A':
		return 10;
	case 'B':
		return 11;
	case 'C':
		return 12;
	case 'D':
		return 13;
	case 'E':
		return 14;
	case 'F':
		return 15;
	}
	return -1;
}
int FindDotPos(char* inptstr) //нахождение точки в числе
{
	int DotPos = 0;
	while (inptstr[DotPos] != '.' && inptstr[DotPos] != '\0')
	{
		DotPos++;
	}
	return DotPos;
}
int DecToOctChngFunc(double resnum)//калькулятор перевода из десятичной в восьмеричную СС
{
	int NumInOct = 0, k = 1;
	while (resnum)
	{
		NumInOct += ((int)resnum % 8) * k;
		k *= 10;
		resnum /= 8;
	}
	return NumInOct;
}
double HexToDecChngFunc(char* inptstr)//калькулятор перевода из шестнатеричной в десятичную СС
{
	double res = 0.0;
	int power = 0;
	power = FindDotPos(inptstr) - 1;
	for (int i = 0; inptstr[i]; i++)
	{
		int SmblToChange = HexToDecTrnslt(inptstr[i]);
		if (SmblToChange != -1)
		{
			res += SmblToChange * pow(16, power);
			power--;
		}
		
	}
	return res;
}

char SwapRegisterBigToSmall(char CharToSwap) //переводчик регистра строки из большего в меньший для кириллицы и латиницы для более удобной выборки предлогов
{
	switch (CharToSwap)
	{
	case 'A':
		return 'a';
	case 'B':
		return 'b';
	case 'C':
		return 'c';
	case 'D':
		return 'd';
	case 'E':
		return 'e';
	case 'F':
		return 'f';
	case 'G':
		return 'g';
	case 'H':
		return 'h';
	case 'I':
		return 'i';
	case 'J':
		return 'j';
	case 'K':
		return 'k';
	case 'L':
		return 'l';
	case 'M':
		return 'm';
	case 'N':
		return 'n';
	case 'O':
		return 'o';
	case 'P':
		return 'p';
	case 'Q':
		return 'q';
	case 'R':
		return 'r';
	case 'S':
		return 's';
	case 'T':
		return 't';
	case 'U':
		return 'u';
	case 'V':
		return 'v';
	case 'W':
		return 'w';
	case 'X':
		return 'x';
	case 'Y':
		return 'y';
	case 'Z':
		return 'z';
	case 'А':
		return 'а';
	case 'Б':
		return 'б';
	case 'В':
		return 'в';
	case 'Г':
		return 'г';
	case 'Д':
		return 'д';
	case 'Е':
		return 'е';
	case 'Ё':
		return 'ё';
	case 'Ж':
		return 'ж';
	case 'З':
		return 'з';
	case 'И':
		return 'и';
	case 'Й':
		return 'й';
	case 'К':
		return 'к';
	case 'Л':
		return 'л';
	case 'М':
		return 'м';
	case 'Н':
		return 'н';
	case 'О':
		return 'о';
	case 'П':
		return 'п';
	case 'Р':
		return 'р';
	case 'С':
		return 'с';
	case 'Т':
		return 'т';
	case 'У':
		return 'у';
	case 'Ф':
		return 'ф';
	case 'Х':
		return 'х';
	case 'Ц':
		return 'ц';
	case 'Ч':
		return 'ч';
	case 'Ш':
		return 'ш';
	case 'Щ':
		return 'щ';
	case 'Ъ':
		return 'ъ';
	case 'Ы':
		return 'ы';
	case 'Ь':
		return 'ь';
	case 'Э':
		return 'э';
	case 'Ю':
		return 'ю';
	case 'Я':
		return 'я';
	default:
		return 0;
	}
}

void ChngeRegisterInStr(char* str) //сама функция которая переводит из большего регистра в меньший
{
	int iChar = 0;
	char smbl = ' ';
	while ((smbl = str[iChar]) != '\0')
	{
		if ((str[iChar] >= -64 && str[iChar] <= -33) || (str[iChar] >= 65 && str[iChar] <= 90))
		{
			str[iChar] = SwapRegisterBigToSmall(smbl);
		}
		iChar++;
	}
}
void Task1(char* arr) // первая часть задания
{
	double ResInDec = HexToDecChngFunc(arr); // переводим число из шестнатеричной в десятичную СС
	printf("%lf\n", ResInDec);
	printf("%d\n", DecToOctChngFunc(ResInDec)); // переводим число из десятичной в восьмеричную СС
	free(arr);
}
int CalcNumPredlFunc(int StrLen, char* arr)//функция считающая количество предлогов в строке
{
	char WordToCheck[1000][1000] = {" "}; // в этот массив будут записываться проверенные слова
	char predlogs[20][6] = { "в","без", "до", "из", "к", "на", "по", "о", "от", "перед", "при", "через", "с", "у", "за", "над", "для", "об", "под", "про" };//предлоги указанные в задание в двумерном массиве дляудобства сравнения
	int WrdLen = 0;
	int PredCount = 0;
	int CheckedWords = 0;
	for (int i = 0; i <= StrLen; i++)
	{
		if (arr[i] != ' ' && arr[i] != '-' && arr[i] != '\0' && arr[i] != '\n')
		{
			if (i != StrLen)
			{
				WordToCheck[CheckedWords][WrdLen] = arr[i];
				WrdLen++;
			}
			else
			{
				goto ApplyLastPredlog; // к последнему слову всегда дописывался мусор из конца строки, из-за этого на одно подходящее слово всегда становится меньше, поэтому если замечено что конец строки близок, к последнему слову не записывается буква вне строки с код переходит сразу к проверке, 5 ли букв в этом слове
			}
		}
		else
		{
			ApplyLastPredlog: //место куда выходит goto
			for (int i = 0; i <= sizeof(predlogs) / sizeof(predlogs[0]); i++)
			{
				if (strcmp(WordToCheck[CheckedWords], predlogs[i]) == 0) //strcmp сравнивает две строки в возвращает 0 если они равны
				{
					PredCount++;
				}

			}
			WrdLen = 0;
			CheckedWords++;
		}
	}
	return PredCount;
}
void Task21(char*arr, int StrLen)
{
	ChngeRegisterInStr(arr); // уменьшаем регистр чтобы было удобно сравнивать предлоги
	printf("predlogs count == %d", CalcNumPredlFunc(StrLen, arr)); // выводим уоличество предлогов
}
	


void Task22(char *arr, int StrLen) 
{
	char WordToCheck[1000][1000] = { " " };
	int WrdLen = 0;
	int CheckedWords = 0;
	int FiveLettersWordsCount = 0;
	for (int i = 0; i <= StrLen; i++)
	{
		if (arr[i] != ' ' && arr[i] != '-' && arr[i] != '\0' && arr[i] != '\n')
		{
			if (i != StrLen)
			{
				WordToCheck[CheckedWords][WrdLen] = arr[i];
				WrdLen++;
			}
			else
			{
				goto ApplyLastWord; //см. строку 250
			}
		}
		else
		{
			ApplyLastWord: //место куда выходит goto
			if (WrdLen == 5)
			{
				FiveLettersWordsCount++;
			}
			
			WrdLen = 0;
			CheckedWords++;
		}
	}
	printf("%d", FiveLettersWordsCount);
}
int main() {
	system("chcp 1251");
	int size = 1000;
	char* InptStr = (char*)malloc(size * sizeof(char));
	printf("input string : ");
	char smbl = ' ';
	int StrLen = 0;
	while ((smbl = getchar())!= '\n')
	{
		InptStr[StrLen] = (char)smbl;
		StrLen++;
	}
	printf("choose homework task 1 or 2 :");
	int option = 0;
	scanf("%d", &option);
	switch (option)
	{
	case 1: 
	{
		Task1(InptStr);
		break;
	}
	case 2:
	{
		printf("choose task 2 parargraph 1 or 2 : ");
		scanf("%d", &option);
		switch (option)
		{
		case 1:
		{
			Task21(InptStr, StrLen);
			break;
		}
		case 2:
		{
			Task22(InptStr, StrLen);
			break;
		}
		default:
			break;
		}
	}
	default:
		break;
	}
	return 1;
}
